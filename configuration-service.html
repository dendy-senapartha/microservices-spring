<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\asciidoc/configuration-service.adoc at 2019-02-18 -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Microservices &#x2013; </title>
	<link rel="stylesheet" href="./css/bulma.css">
    <style type="text/css" media="all">
      @import url("./css/style.css");
      @import url("./css/site.css");
    </style>
    <meta http-equiv="Content-Language" content="en" />
<link rel="icon" href="./images/mitrais-logo.png">
				<link rel="stylesheet" href="./libs/highlightjs/github.css">
				<link rel="stylesheet" href="./css/mitrais.css">
				<script src="./libs/highlightjs/highlight.pack.js"></script>
				<script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="composite">
  <!-- START BANNER -->
  <nav id="banner" class="navbar has-shadow is-spaced">
	  <div class="container">
	  	  <div class="navbar-brand">
		  	  <a class="navbar-item" href="https://mitrais.github.io/microservice" id="bannerLeft"><h1 class="title is-5">Microservices</h1>
</a>

			  <div class="navbar-burger burger" data-target="navbarMenu">
				<span></span>
				<span></span>
				<span></span>
			  </div>
		  </div>
		  <div class="navbar-menu" id="navbarMenu">
			  <div class="navbar-start is-hidden-desktop">
			  <div class="navbar-item">
       <p class="menu-label">Documentation</p>
    <ul class="menu-list">
<li>
<a href="index.html" title="Overview">Overview</a></li>
<li>
<a href="project-layout.html" title="Project Layout">Project Layout</a></li>
<li>
<a href="#" title="Non-Functional">Non-Functional</a>
      <ul class="menu-list">
<li>
<a class="is-active" href="#">Configuration Service</a></li>
<li>
<a href="registry-service.html" title="Registry Service">Registry Service</a></li>
      </ul></li>
<li>
<a href="#" title="Functional">Functional</a>
      <ul class="menu-list">
<li>
<a href="product-service.html" title="Product Service">Product Service</a></li>
<li>
<a href="account-service.html" title="Account Service">Account Service</a></li>
      </ul></li>
<li>
<a href="./tests.html" title="Tests">Tests</a></li>
    </ul>
       <p class="menu-label">Info and reports</p>
    <ul class="menu-list">
<li>
<a href="./project-info.html" title="Info">Info</a></li>
<li>
<a href="./project-reports.html" title="Reports">Reports</a></li>
<li>
<a href="./apidocs/" title="JavaDocs">JavaDocs</a></li>
    </ul>
       <p class="menu-label">Github</p>
    <ul class="menu-list">
<li>
<a href="https://github.com/Mitrais/microservices" class="externalLink" title="SCM">SCM</a></li>
<li>
<a href="https://github.com/Mitrais/microservices/issues" class="externalLink" title="Issues">Issues</a></li>
    </ul>
       <p class="menu-label">Mitrais</p>
    <ul class="menu-list">
<li>
<a href="https://www.mitrais.com" class="externalLink" title="Website">Website</a></li>
<li>
<a href="https://github.com/Mitrais" class="externalLink" title="Github">Github</a></li>
    </ul>
       <p class="menu-label">Icons</p>
    <ul class="menu-list">
<li>
<a href="https://github.com/Mitrais/microservices" class="externalLink" title="Github"><img class="imageLink" src="github" alt=""/>Github</a></li>
    </ul>
       <p class="menu-label">Overview</p>
    <ul class="menu-list">
<li>
<a href="./overview.html" title="Overview">Overview</a></li>
    </ul>
			  </div>
			  </div>
			  <div class="navbar-end">
			  	  <div class="navbar-brand">
				  					  </div>
			  </div>
		  </div>
	  </div>
  </nav>
  <!-- END BANNER -->
  <div class="main container">
	<div class="columns">
		<div class="column is-3">
			<aside class="menu is-hidden-mobile">
       <p class="menu-label">Documentation</p>
    <ul class="menu-list">
<li>
<a href="index.html" title="Overview">Overview</a></li>
<li>
<a href="project-layout.html" title="Project Layout">Project Layout</a></li>
<li>
<a href="#" title="Non-Functional">Non-Functional</a>
      <ul class="menu-list">
<li>
<a class="is-active" href="#">Configuration Service</a></li>
<li>
<a href="registry-service.html" title="Registry Service">Registry Service</a></li>
      </ul></li>
<li>
<a href="#" title="Functional">Functional</a>
      <ul class="menu-list">
<li>
<a href="product-service.html" title="Product Service">Product Service</a></li>
<li>
<a href="account-service.html" title="Account Service">Account Service</a></li>
      </ul></li>
<li>
<a href="./tests.html" title="Tests">Tests</a></li>
    </ul>
       <p class="menu-label">Info and reports</p>
    <ul class="menu-list">
<li>
<a href="./project-info.html" title="Info">Info</a></li>
<li>
<a href="./project-reports.html" title="Reports">Reports</a></li>
<li>
<a href="./apidocs/" title="JavaDocs">JavaDocs</a></li>
    </ul>
       <p class="menu-label">Github</p>
    <ul class="menu-list">
<li>
<a href="https://github.com/Mitrais/microservices" class="externalLink" title="SCM">SCM</a></li>
<li>
<a href="https://github.com/Mitrais/microservices/issues" class="externalLink" title="Issues">Issues</a></li>
    </ul>
       <p class="menu-label">Mitrais</p>
    <ul class="menu-list">
<li>
<a href="https://www.mitrais.com" class="externalLink" title="Website">Website</a></li>
<li>
<a href="https://github.com/Mitrais" class="externalLink" title="Github">Github</a></li>
    </ul>
       <p class="menu-label">Icons</p>
    <ul class="menu-list">
<li>
<a href="https://github.com/Mitrais/microservices" class="externalLink" title="Github"><img class="imageLink" src="github" alt=""/>Github</a></li>
    </ul>
       <p class="menu-label">Overview</p>
    <ul class="menu-list">
<li>
<a href="./overview.html" title="Overview">Overview</a></li>
    </ul>
			</aside>
		</div>
		<div class="column is-9">
			<nav class="breadcrumb" aria-label="breadcrumbs">
<ul>
<li>
<a href="#" aria-current="page">Configuration Service</a>
</li>
</ul>
			</nav>
			<article class="content"><h1>Configuration Service</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The main function of the service is to centralized configuration for other services. It will provides
configuration needed by other services upon starting up the service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuUAATixFIyjCBorABCdCprC8JYqgoqnEZLL8B5P81ijmHGUbfcSMbnHLeaWMGGMveWEAybDAaqjGP0iWObpH_YKPgKKeKlaW4IukYE4Akhe6chgw2DDGXM76e8f2J718pKi1-W00" alt="Embedded" width="600"/>
</div>
</div>
<div class="paragraph">
<p>The service utilised <a href="http://http://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.0.2.RELEASE/single/spring-cloud-config.html">Spring Cloud Config</a>
server and uses file-system as backend. In production, you may consider other alternatives such as
Git, SVN, Vault or JDBC as backend.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration file for this service is using YAML file.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  application:
    name: configuration
  profiles:
    active:
      - native # important for file system based configuration server
  cloud:
    config:
      server:
        native:
          searchLocations: classpath:/config # location for client's configuration files (service-name.yml)
# EUREKA DISCOVERY
eureka:
  client:
    healthcheck:
      enabled: true
    fetchRegistry: false # no need to resolve other services
    serviceUrl:
      defaultZone: http://localhost:9091/eureka # register this service with registry
  instance:
    instanceId: ${spring.application.name}:${spring.application.instance_id:${random.value}}
    leaseRenewalIntervalInSeconds: 5   # DO NOT DO THIS IN PRODUCTION
# TOMCAT
server:
  port: 9090
# ACTUATOR ENDPOINTS
management:
  endpoints:
    web:
      exposure:
        include:
          - health
          - info
          - env</code></pre>
</div>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="paragraph">
<p>One thing to note on the above configuration is the location of the configuration files for other
services described in <code>spring.cloud.config.server.native.searchLocations</code> property. The value is
pointing to classpath inside config directory, therefore configuration files for other services
should be place in that directory with the file name format <code>service-name.[yml|properties]</code>.
<br/></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">configuration-service
├── src
    ├── main
        ├── resources
            └── config
                └── account.yml
                └── authorization.yml
                └── gateway.yml
                └── order.yml
                └── product.yml
                └── registry.yml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To test the service, build and run the project as described in <a href="project-layout.html">Project Layout</a>
then open the browser and access the following url format <code>[hostname]:[port]/[service-name]/[profile]</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[hostname]</code> is the server name or ip address e.g. localhost, 127.0.0.1</p>
</li>
<li>
<p><code>[port]</code> is the server port e.g. 9090</p>
</li>
<li>
<p><code>[service-name]</code> is the <em>configuration name</em>.</p>
</li>
<li>
<p><code>[profile]</code> is the <em>profile name</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default the service will run using port number 9090. Example, to load default configuration for
<em>product-service</em> use this url <a href="http://localhost:9090/product/default" class="bare">http://localhost:9090/product/default</a>
<br/></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"product",
   "profiles":[
      "default"
   ],
   "label":null,
   "version":null,
   "state":null,
   "propertySources":[
      {
         "name":"classpath:/config/product.yml (document #0)",
         "source":{
            "token.signingKey":123,
            "logging.level.org.springframework.security":"DEBUG",
            "eureka.client.healthcheck.enabled":true,
            "eureka.client.fetchRegistry":false,
            "eureka.client.serviceUrl.defaultZone":"http://localhost:9091/eureka",
            "eureka.instance.instanceId":"${spring.application.name}:${spring.application.instance_id:${random.value}}",
            "eureka.instance.leaseRenewalIntervalInSeconds":5,
            "server.port":8084,
            "management.endpoints.web.exposure.include[0]":"health",
            "management.endpoints.web.exposure.include[1]":"info",
            "management.endpoints.web.exposure.include[2]":"env"
         }
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><br/></p>
</div>
<div class="paragraph">
<p>To load docker configuration for <em>product_service</em> use this url <a href="http://localhost:9090/product/docker" class="bare">http://localhost:9090/product/docker</a>
<br/></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"product",
   "profiles":[
      "docker"
   ],
   "label":null,
   "version":null,
   "state":null,
   "propertySources":[
      {
         "name":"classpath:/config/product.yml (document #1)",
         "source":{
            "spring.profiles":"docker",
            "eureka.client.registerWithEureka":true,
            "eureka.client.fetchRegistry":true,
            "eureka.client.serviceUrl.defaultZone":"http://node0.registry/eureka, http://node1.registry/eureka",
            "eureka.instance.instanceId":"${spring.application.name}:${HOSTNAME}",
            "server.port":80
         }
      },
      {
         "name":"classpath:/config/product.yml (document #0)",
         "source":{
            "token.signingKey":123,
            "logging.level.org.springframework.security":"DEBUG",
            "eureka.client.healthcheck.enabled":true,
            "eureka.client.fetchRegistry":false,
            "eureka.client.serviceUrl.defaultZone":"http://localhost:9091/eureka",
            "eureka.instance.instanceId":"${spring.application.name}:${spring.application.instance_id:${random.value}}",
            "eureka.instance.leaseRenewalIntervalInSeconds":5,
            "server.port":8084,
            "management.endpoints.web.exposure.include[0]":"health",
            "management.endpoints.web.exposure.include[1]":"info",
            "management.endpoints.web.exposure.include[2]":"env"
         }
      }
   ]
}</code></pre>
</div>
</div>
</div>
</div></article>
		</div>
	</div>
  </div>
  <footer class="footer">
      <div class="container">
      <!-- FOOTER-->
		<div class="columns">
			<div class="column is-6">
	        	Copyright &#169;      2019 <a href="https://www.mitrais.com">Mitrais</a>.
All rights reserved.			</div>
			<div class="column is-6">
                <a href="https://maven.apache.org/"><img src="./images/maven-feather.png"/></a>
                <a href="https://bulma.io"><img src="./images/bulma-logo.png"/></a>
			</div>
		</div>
      </div>
   </footer>
   <script async type="text/javascript" src="./js/script.js"></script>
  </body>
</html>
